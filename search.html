<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Search and discover biodata profiles on EWU Matrimony. Find your perfect match from verified East West University profiles.">
    <title>Search Biodatas - EWU Matrimony</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;600;700;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="pages.css">
    <link rel="stylesheet" href="search_filters.css">
    <link rel="stylesheet" href="icons.css">
</head>

<body>
    <!-- Header -->
    <header class="header header-solid" id="header">
        <div class="container">
            <nav class="nav">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                        </svg>
                    </div>
                    <span>EWU Matrimony</span>
                </a>

                <div class="nav-links">
                    <a href="search.html" class="nav-link active">Search Biodatas</a>
                    <a href="about.html" class="nav-link">About Us</a>
                    <a href="contact.html" class="nav-link">Contact</a>
                </div>

                <div class="nav-buttons">
                    <!-- Theme Toggle Removed -->
                    <a href="login.html" class="btn btn-outline-dark">Login</a>
                    <a href="register.html" class="btn btn-primary">Sign Up</a>
                </div>

                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
    <div class="mobile-menu" id="mobileMenu">
        <button class="mobile-menu-close" id="mobileMenuClose">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
        </button>
        <div class="mobile-nav-links">
            <a href="index.html">Home</a>
            <a href="search.html">Search Biodatas</a>
            <a href="about.html">About Us</a>
            <a href="contact.html">Contact</a>
            <a href="login.html">Login</a>
            <a href="register.html">Sign Up</a>
        </div>
    </div>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Search Biodatas</h1>
            <p>Discover verified profiles from East West University</p>
        </div>
    </section>

    <!-- Search Section -->
    <section class="search-section">
        <div class="container">
            <div class="search-layout">
                <!-- Filters Sidebar -->
                <aside class="filters-sidebar">
                    <div class="filter-header">
                        <h3>
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"
                                style="margin-right: 8px;">
                                <path
                                    d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                            </svg>
                            Filters
                        </h3>
                        <button class="btn-text" onclick="resetFilters()">Reset All</button>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Gender</label>
                        <div class="filter-options">
                            <label class="radio-option">
                                <input type="radio" name="gender" value="male">
                                <span>Male</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="gender" value="female">
                                <span>Female</span>
                            </label>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Age Range: <span id="ageLabel">18 - 35</span> yrs</label>
                        <div class="range-slider">
                            <div class="slider-container">
                                <div class="slider-track" id="sliderTrack"></div>
                                <div class="range-input">
                                    <input type="range" id="minAge" min="18" max="60" value="18" step="1">
                                    <input type="range" id="maxAge" min="18" max="60" value="35" step="1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Religion</label>
                        <select class="filter-select">
                            <option value="">Any Religion</option>
                            <option value="islam">Islam</option>
                            <option value="hinduism">Hinduism</option>
                            <option value="christianity">Christianity</option>
                            <option value="buddhism">Buddhism</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Education</label>
                        <select class="filter-select">
                            <option value="">Any Education</option>
                            <option value="undergraduate">Undergraduate</option>
                            <option value="graduate">Graduate</option>
                            <option value="postgraduate">Post Graduate</option>
                            <option value="doctorate">Doctorate</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">EWU Department</label>
                        <select class="filter-select">
                            <option value="">Any Department</option>
                            <option value="cse">Computer Science & Engineering</option>
                            <option value="eee">Electrical & Electronic Engineering</option>
                            <option value="bba">Business Administration</option>
                            <option value="english">English</option>
                            <option value="pharmacy">Pharmacy</option>
                            <option value="law">Law</option>
                            <option value="economics">Economics</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Batch Year</label>
                        <select class="filter-select">
                            <option value="">Any Batch</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2019">2019</option>
                            <option value="older">2018 or older</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label class="filter-label">Marital Status</label>
                        <select class="filter-select">
                            <option value="">Any Status</option>
                            <option value="never-married">Never Married</option>
                            <option value="divorced">Divorced</option>
                            <option value="widowed">Widowed</option>
                        </select>
                    </div>

                    <button class="btn btn-primary btn-block">Apply Filters</button>
                </aside>

                <!-- Search Results -->
                <div class="search-results">
                    <div class="results-header">
                        <p class="results-count">Showing <strong>24</strong> EWU profiles</p>
                        <div class="sort-options">
                            <label>Sort by:</label>
                            <select class="sort-select">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                                <option value="age-low">Age: Low to High</option>
                                <option value="age-high">Age: High to Low</option>
                            </select>
                        </div>
                    </div>

                    <!-- Profile Cards Grid - Loaded Dynamically -->
                    <div class="profiles-grid" id="profilesGrid">
                        <!-- Loading state -->
                        <div class="loading-state" style="grid-column: span 3; text-align:center; padding:3rem;">
                            <p>Loading verified profiles...</p>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination">
                        <button class="page-btn" disabled>
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg>
                            Previous
                        </button>
                        <div class="page-numbers">
                            <button class="page-num active">1</button>
                            <button class="page-num">2</button>
                            <button class="page-num">3</button>
                            <span>...</span>
                            <button class="page-num">10</button>
                        </div>
                        <button class="page-btn">
                            Next
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <div class="logo-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                        </div>
                        <span>EWU Matrimony</span>
                    </a>
                    <p>Find your marriage partner from East West University.</p>
                    <div class="social-links">
                        <a href="#" class="social-link">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z" />
                            </svg>
                        </a>
                        <a href="#" class="social-link">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z" />
                            </svg>
                        </a>
                        <a href="#" class="social-link">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z" />
                            </svg>
                        </a>
                    </div>
                </div>

                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="search.html">Search Biodatas</a></li>
                        <li><a href="edit_biodata.html">Create Biodata</a></li>
                        <li><a href="login.html">Login</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Help Center</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 EWU Matrimony. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        function resetFilters() {
            document.querySelectorAll('.filters-sidebar input, .filters-sidebar select').forEach(el => {
                if (el.type === 'radio' || el.type === 'checkbox') {
                    el.checked = false;
                } else {
                    el.value = '';
                }
            });
            loadProfiles();
        }

        // Slider Logic
        const minAgeInput = document.getElementById('minAge');
        const maxAgeInput = document.getElementById('maxAge');
        const ageLabel = document.getElementById('ageLabel');
        const sliderTrack = document.getElementById('sliderTrack');
        const minGap = 2;

        function updateSlider() {
            let minAge = parseInt(minAgeInput.value);
            let maxAge = parseInt(maxAgeInput.value);

            if (maxAge - minAge <= minGap) {
                if (event.target.id === "minAge") {
                    minAgeInput.value = maxAge - minGap;
                } else {
                    maxAgeInput.value = minAge + minGap;
                }
            }

            ageLabel.textContent = `${minAgeInput.value} - ${maxAgeInput.value}`;
            fillTrack();
            loadProfiles(); // Auto load on change
        }

        function fillTrack() {
            const min = parseInt(minAgeInput.min);
            const max = parseInt(minAgeInput.max);
            const percent1 = ((minAgeInput.value - min) / (max - min)) * 100;
            const percent2 = ((maxAgeInput.value - min) / (max - min)) * 100;

            sliderTrack.style.left = percent1 + "%";
            sliderTrack.style.width = (percent2 - percent1) + "%";
        }

        minAgeInput.addEventListener('input', updateSlider);
        maxAgeInput.addEventListener('input', updateSlider);

        async function loadProfiles() {
            const grid = document.getElementById('profilesGrid');
            grid.innerHTML = '<div class="loading-state" style="grid-column: span 3; text-align:center; padding:3rem;"><p>Loading verified profiles...</p></div>';

            try {
                // Get filter values
                const gender = document.querySelector('input[name="gender"]:checked')?.value || '';
                const religion = document.querySelector('.filters-sidebar select')?.value || '';
                const minAge = minAgeInput.value;
                const maxAge = maxAgeInput.value;

                const response = await fetch(`api/search?gender=${gender}&religion=${religion}&min_age=${minAge}&max_age=${maxAge}`);
                const profiles = await response.json();

                // Update count
                document.querySelector('.results-count strong').textContent = profiles.length;

                if (profiles.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: span 3; text-align:center; padding:4rem;">
                            <h3 style="color:var(--gray-500);">No verified profiles found</h3>
                            <p style="color:var(--gray-400);">Try adjusting your filters.</p>
                        </div>
                    `;
                    return;
                }

                // ... rest of rendering code ...
                grid.innerHTML = '';
                profiles.forEach(profile => {
                    // ... (rendering code same as before, see next chunk) ...
                    const photoSrc = profile.photo
                        ? (profile.photo.startsWith('http') ? profile.photo : `uploads/${profile.photo}`)
                        : `https://ui-avatars.com/api/?name=${profile.first_name}+${profile.last_name}&background=random&size=400`;

                    const card = document.createElement('div');
                    card.className = 'profile-card';
                    card.innerHTML = `
                        <div class="profile-image">
                            <img src="${photoSrc}" alt="${profile.first_name}">
                            <span class="verified-badge">
                                <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" style="margin-right: 3px;">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                                </svg>
                                EWU Verified
                            </span>
                        </div>
                        <div class="profile-info">
                            <h4>${profile.first_name} ${profile.last_name}</h4>
                            <p class="profile-details">${profile.age || '?'} yrs • ${profile.height || 'N/A'} • ${profile.education || profile.student_status}</p>
                            <p class="profile-location">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
                                </svg>
                                ${profile.occupation || 'EWU Student'}
                            </p>
                            <p class="profile-education">
                                <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                    <path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z" />
                                </svg>
                                Batch ${profile.batch_year}
                            </p>
                            <div class="profile-actions">
                                <a href="profile.html?id=${profile.id}" class="btn btn-primary btn-sm">View Profile</a>
                                <button class="btn-icon" onclick="sendInterest(${profile.id}, this)" title="Express Interest">
                                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                                    </svg>
                                </button>
                                <button class="btn-icon" onclick="toggleFavorite(${profile.id}, this)" title="Add to Favorites" style="color:#f59e0b;">
                                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });

            } catch (e) {
                console.error('Error loading profiles:', e);
                grid.innerHTML = '<div style="grid-column: span 3; text-align:center; padding:3rem; color:var(--danger);">Error loading profiles. Please try again.</div>';
            }
        }

        // Apply filters button
        document.querySelector('.filters-sidebar .btn-primary')?.addEventListener('click', loadProfiles);

        // Send Interest to a user
        async function sendInterest(userId, btn) {
            try {
                btn.disabled = true;
                btn.innerHTML = '...';

                const response = await fetch('api/interest?action=send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ to_user_id: userId })
                });

                const result = await response.json();

                if (result.success) {
                    btn.style.color = 'var(--primary)';
                    btn.innerHTML = '';
                    btn.title = 'Interest Sent!';

                    if (result.is_match) {
                        alert(" It's a Match! You can now chat with this person. Go to 'My Matches' to start a conversation.");
                    } else {
                        alert('Interest sent! If they like you back, you can connect.');
                    }
                } else {
                    alert(result.message);
                    btn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>';
                }
            } catch (e) {
                alert('Please login to express interest');
                btn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>';
            }
            btn.disabled = false;
        }

        async function toggleFavorite(userId, btn) {
            try {
                const response = await fetch('api/favorites?action=add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }, // Added headers for JSON body
                    body: JSON.stringify({ user_id: userId })
                });
                const result = await response.json();

                if (result.success) {
                    const icon = btn.querySelector('svg');
                    if (result.action === 'added') {
                        icon.setAttribute('fill', 'currentColor'); // Solid star
                        Toast.success('Shortlisted', 'Profile added to your favorites');
                    } else {
                        icon.setAttribute('fill', 'none'); // Outline star
                        Toast.info('Removed', 'Profile removed from favorites');
                    }
                } else {
                    Toast.warning('Notice', result.message);
                }
            } catch (e) {
                console.error('Error toggling favorite:', e);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadProfiles();
        });
    </script>
</body>

</html>
```